[{"url":"https://api.github.com/repos/gbrlcustodio/pipefy-mcp-server/pulls/comments/2695912017","pull_request_review_id":3667521295,"id":2695912017,"node_id":"PRRC_kwDOOWTmiM6gsFpR","diff_hunk":"@@ -391,6 +543,103 @@ async def search_pipes(pipe_name: str | None = None) -> dict:\n             \"\"\"\n             return await client.search_pipes(pipe_name)\n \n+        @mcp.tool(\n+            annotations=ToolAnnotations(\n+                destructiveHint=True,\n+            ),\n+        )\n+        async def delete_card(\n+            card_id: int, confirm: bool = False, debug: bool = False\n+        ) -> DeleteCardPayload:\n+            \"\"\"Delete a card from Pipefy.\n+\n+            This is a destructive operation that permanently removes a card.\n+            Use with caution.\n+\n+            Args:\n+                card_id: The ID of the card to delete\n+                confirm: Set to true to confirm deletion. If false, returns a preview only.\n+                debug: When true, appends GraphQL error codes and correlation_id to the error message.\n+\n+            Returns:\n+                Preview information when confirm=false, or success/error status when confirm=true.\n+            \"\"\"\n+            # Input validation\n+            if card_id <= 0:\n+                return build_delete_card_error_payload(\n+                    message=\"Invalid 'card_id'. Please provide a positive integer.\"\n+                )\n+\n+            if not confirm:\n+                # Preview mode: fetch card details and return preview","path":"src/pipefy_mcp/tools/pipe_tools.py","commit_id":"f325cc546afc216449cda83b06c97e2ab62a51bf","original_commit_id":"f325cc546afc216449cda83b06c97e2ab62a51bf","user":{"login":"Danielmoraisg","id":50711061,"node_id":"MDQ6VXNlcjUwNzExMDYx","avatar_url":"https://avatars.githubusercontent.com/u/50711061?v=4","gravatar_id":"","url":"https://api.github.com/users/Danielmoraisg","html_url":"https://github.com/Danielmoraisg","followers_url":"https://api.github.com/users/Danielmoraisg/followers","following_url":"https://api.github.com/users/Danielmoraisg/following{/other_user}","gists_url":"https://api.github.com/users/Danielmoraisg/gists{/gist_id}","starred_url":"https://api.github.com/users/Danielmoraisg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Danielmoraisg/subscriptions","organizations_url":"https://api.github.com/users/Danielmoraisg/orgs","repos_url":"https://api.github.com/users/Danielmoraisg/repos","events_url":"https://api.github.com/users/Danielmoraisg/events{/privacy}","received_events_url":"https://api.github.com/users/Danielmoraisg/received_events","type":"User","user_view_type":"public","site_admin":false},"body":"Instead of having a parameter to confirm the execution, WDYT of using elicitation to request confirmation from the user before moving on with the deletion?","created_at":"2026-01-15T20:48:17Z","updated_at":"2026-01-16T11:53:51Z","html_url":"https://github.com/gbrlcustodio/pipefy-mcp-server/pull/25#discussion_r2695912017","pull_request_url":"https://api.github.com/repos/gbrlcustodio/pipefy-mcp-server/pulls/25","_links":{"self":{"href":"https://api.github.com/repos/gbrlcustodio/pipefy-mcp-server/pulls/comments/2695912017"},"html":{"href":"https://github.com/gbrlcustodio/pipefy-mcp-server/pull/25#discussion_r2695912017"},"pull_request":{"href":"https://api.github.com/repos/gbrlcustodio/pipefy-mcp-server/pulls/25"}},"reactions":{"url":"https://api.github.com/repos/gbrlcustodio/pipefy-mcp-server/pulls/comments/2695912017/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":null,"original_start_line":null,"start_side":null,"line":574,"original_line":574,"side":"RIGHT","author_association":"COLLABORATOR","original_position":202,"position":202,"subject_type":"line"},{"url":"https://api.github.com/repos/gbrlcustodio/pipefy-mcp-server/pulls/comments/2698185428","pull_request_review_id":3667521295,"id":2698185428,"node_id":"PRRC_kwDOOWTmiM6g0wrU","diff_hunk":"@@ -391,6 +543,103 @@ async def search_pipes(pipe_name: str | None = None) -> dict:\n             \"\"\"\n             return await client.search_pipes(pipe_name)\n \n+        @mcp.tool(\n+            annotations=ToolAnnotations(\n+                destructiveHint=True,\n+            ),\n+        )\n+        async def delete_card(","path":"src/pipefy_mcp/tools/pipe_tools.py","commit_id":"f325cc546afc216449cda83b06c97e2ab62a51bf","original_commit_id":"f325cc546afc216449cda83b06c97e2ab62a51bf","user":{"login":"Danielmoraisg","id":50711061,"node_id":"MDQ6VXNlcjUwNzExMDYx","avatar_url":"https://avatars.githubusercontent.com/u/50711061?v=4","gravatar_id":"","url":"https://api.github.com/users/Danielmoraisg","html_url":"https://github.com/Danielmoraisg","followers_url":"https://api.github.com/users/Danielmoraisg/followers","following_url":"https://api.github.com/users/Danielmoraisg/following{/other_user}","gists_url":"https://api.github.com/users/Danielmoraisg/gists{/gist_id}","starred_url":"https://api.github.com/users/Danielmoraisg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Danielmoraisg/subscriptions","organizations_url":"https://api.github.com/users/Danielmoraisg/orgs","repos_url":"https://api.github.com/users/Danielmoraisg/repos","events_url":"https://api.github.com/users/Danielmoraisg/events{/privacy}","received_events_url":"https://api.github.com/users/Danielmoraisg/received_events","type":"User","user_view_type":"public","site_admin":false},"body":"This file is starting to grow a and have many different responsibilities, WDYT of starting a new pattern were we have `src/pipefy-mcp/tools/<domain>/<tool>`? In this case it would be `src/pipefy-mcp/tools/card/delete_card.py`","created_at":"2026-01-16T11:35:24Z","updated_at":"2026-01-16T11:53:51Z","html_url":"https://github.com/gbrlcustodio/pipefy-mcp-server/pull/25#discussion_r2698185428","pull_request_url":"https://api.github.com/repos/gbrlcustodio/pipefy-mcp-server/pulls/25","_links":{"self":{"href":"https://api.github.com/repos/gbrlcustodio/pipefy-mcp-server/pulls/comments/2698185428"},"html":{"href":"https://github.com/gbrlcustodio/pipefy-mcp-server/pull/25#discussion_r2698185428"},"pull_request":{"href":"https://api.github.com/repos/gbrlcustodio/pipefy-mcp-server/pulls/25"}},"reactions":{"url":"https://api.github.com/repos/gbrlcustodio/pipefy-mcp-server/pulls/comments/2698185428/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":546,"original_start_line":546,"start_side":"RIGHT","line":551,"original_line":551,"side":"RIGHT","author_association":"COLLABORATOR","original_position":179,"position":179,"subject_type":"line"},{"url":"https://api.github.com/repos/gbrlcustodio/pipefy-mcp-server/pulls/comments/2698210749","pull_request_review_id":3667521295,"id":2698210749,"node_id":"PRRC_kwDOOWTmiM6g0229","diff_hunk":"@@ -0,0 +1,65 @@\n+from unittest.mock import Mock, patch\n+\n+from pipefy_mcp.core.container import ServicesContainer\n+from pipefy_mcp.services.pipefy import PipefyClient\n+from pipefy_mcp.settings import PipefySettings, Settings\n+\n+\n+class TestServicesContainer:\n+    \"\"\"Test cases for ServicesContainer\"\"\"\n+\n+    def test_get_instance_returns_singleton(self):\n+        \"\"\"Test that get_instance returns the same instance\"\"\"\n+        # Reset singleton for test\n+        ServicesContainer._instance = None\n+\n+        instance1 = ServicesContainer.get_instance()\n+        instance2 = ServicesContainer.get_instance()\n+\n+        assert instance1 is instance2\n+        assert isinstance(instance1, ServicesContainer)\n+\n+    def test_get_instance_creates_new_instance_when_none(self):\n+        \"\"\"Test that get_instance creates a new instance when _instance is None\"\"\"\n+        # Reset singleton for test\n+        ServicesContainer._instance = None","path":"tests/core/test_container.py","commit_id":"f325cc546afc216449cda83b06c97e2ab62a51bf","original_commit_id":"f325cc546afc216449cda83b06c97e2ab62a51bf","user":{"login":"Danielmoraisg","id":50711061,"node_id":"MDQ6VXNlcjUwNzExMDYx","avatar_url":"https://avatars.githubusercontent.com/u/50711061?v=4","gravatar_id":"","url":"https://api.github.com/users/Danielmoraisg","html_url":"https://github.com/Danielmoraisg","followers_url":"https://api.github.com/users/Danielmoraisg/followers","following_url":"https://api.github.com/users/Danielmoraisg/following{/other_user}","gists_url":"https://api.github.com/users/Danielmoraisg/gists{/gist_id}","starred_url":"https://api.github.com/users/Danielmoraisg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Danielmoraisg/subscriptions","organizations_url":"https://api.github.com/users/Danielmoraisg/orgs","repos_url":"https://api.github.com/users/Danielmoraisg/repos","events_url":"https://api.github.com/users/Danielmoraisg/events{/privacy}","received_events_url":"https://api.github.com/users/Danielmoraisg/received_events","type":"User","user_view_type":"public","site_admin":false},"body":"Instead of having to reset the singleton every time WDYT of using setup and teardown fixtures?","created_at":"2026-01-16T11:44:16Z","updated_at":"2026-01-16T11:53:51Z","html_url":"https://github.com/gbrlcustodio/pipefy-mcp-server/pull/25#discussion_r2698210749","pull_request_url":"https://api.github.com/repos/gbrlcustodio/pipefy-mcp-server/pulls/25","_links":{"self":{"href":"https://api.github.com/repos/gbrlcustodio/pipefy-mcp-server/pulls/comments/2698210749"},"html":{"href":"https://github.com/gbrlcustodio/pipefy-mcp-server/pull/25#discussion_r2698210749"},"pull_request":{"href":"https://api.github.com/repos/gbrlcustodio/pipefy-mcp-server/pulls/25"}},"reactions":{"url":"https://api.github.com/repos/gbrlcustodio/pipefy-mcp-server/pulls/comments/2698210749/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":null,"original_start_line":null,"start_side":null,"line":25,"original_line":25,"side":"RIGHT","author_association":"COLLABORATOR","original_position":25,"position":25,"subject_type":"line"},{"url":"https://api.github.com/repos/gbrlcustodio/pipefy-mcp-server/pulls/comments/2698222285","pull_request_review_id":3667521295,"id":2698222285,"node_id":"PRRC_kwDOOWTmiM6g05rN","diff_hunk":"@@ -24,10 +24,15 @@ def client_session() -> ClientSession:\n \n \n @pytest.mark.anyio\n-async def test_register_tools(client_session: ClientSession):\n+async def test_register_tools(client_session):\n+    # Skip if settings are not properly configured (e.g., no GraphQL URL)\n+    if not settings.pipefy.graphql_url:\n+        pytest.skip(\"GraphQL URL not configured for integration tests\")","path":"tests/test_server.py","commit_id":"f325cc546afc216449cda83b06c97e2ab62a51bf","original_commit_id":"f325cc546afc216449cda83b06c97e2ab62a51bf","user":{"login":"Danielmoraisg","id":50711061,"node_id":"MDQ6VXNlcjUwNzExMDYx","avatar_url":"https://avatars.githubusercontent.com/u/50711061?v=4","gravatar_id":"","url":"https://api.github.com/users/Danielmoraisg","html_url":"https://github.com/Danielmoraisg","followers_url":"https://api.github.com/users/Danielmoraisg/followers","following_url":"https://api.github.com/users/Danielmoraisg/following{/other_user}","gists_url":"https://api.github.com/users/Danielmoraisg/gists{/gist_id}","starred_url":"https://api.github.com/users/Danielmoraisg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Danielmoraisg/subscriptions","organizations_url":"https://api.github.com/users/Danielmoraisg/orgs","repos_url":"https://api.github.com/users/Danielmoraisg/repos","events_url":"https://api.github.com/users/Danielmoraisg/events{/privacy}","received_events_url":"https://api.github.com/users/Danielmoraisg/received_events","type":"User","user_view_type":"public","site_admin":false},"body":"I believe we should not skip the test if something is misconfigured, we should have it fail in these cases. But since this is a test env and we have full control over it this should never happen, or am i missing something?","created_at":"2026-01-16T11:48:22Z","updated_at":"2026-01-16T11:53:51Z","html_url":"https://github.com/gbrlcustodio/pipefy-mcp-server/pull/25#discussion_r2698222285","pull_request_url":"https://api.github.com/repos/gbrlcustodio/pipefy-mcp-server/pulls/25","_links":{"self":{"href":"https://api.github.com/repos/gbrlcustodio/pipefy-mcp-server/pulls/comments/2698222285"},"html":{"href":"https://github.com/gbrlcustodio/pipefy-mcp-server/pull/25#discussion_r2698222285"},"pull_request":{"href":"https://api.github.com/repos/gbrlcustodio/pipefy-mcp-server/pulls/25"}},"reactions":{"url":"https://api.github.com/repos/gbrlcustodio/pipefy-mcp-server/pulls/comments/2698222285/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":28,"original_start_line":28,"start_side":"RIGHT","line":30,"original_line":30,"side":"RIGHT","author_association":"COLLABORATOR","original_position":31,"position":31,"subject_type":"line"},{"url":"https://api.github.com/repos/gbrlcustodio/pipefy-mcp-server/pulls/comments/2698240896","pull_request_review_id":3670538367,"id":2698240896,"node_id":"PRRC_kwDOOWTmiM6g0-OA","diff_hunk":"@@ -751,7 +751,15 @@ async def test_get_card_passes_card_id_variable():\n     card_id = 12345\n \n     mock_session = AsyncMock()\n-    mock_session.execute = AsyncMock(return_value={\"card\": {\"id\": str(card_id)}})\n+    mock_session.execute = AsyncMock(\n+        return_value={\n+            \"card\": {\n+                \"id\": str(card_id),\n+                \"title\": \"Test Card\",\n+                \"pipe\": {\"id\": \"123\", \"name\": \"Test Pipe\"},","path":"tests/services/test_pipefy_client.py","commit_id":"f325cc546afc216449cda83b06c97e2ab62a51bf","original_commit_id":"f325cc546afc216449cda83b06c97e2ab62a51bf","user":{"login":"Danielmoraisg","id":50711061,"node_id":"MDQ6VXNlcjUwNzExMDYx","avatar_url":"https://avatars.githubusercontent.com/u/50711061?v=4","gravatar_id":"","url":"https://api.github.com/users/Danielmoraisg","html_url":"https://github.com/Danielmoraisg","followers_url":"https://api.github.com/users/Danielmoraisg/followers","following_url":"https://api.github.com/users/Danielmoraisg/following{/other_user}","gists_url":"https://api.github.com/users/Danielmoraisg/gists{/gist_id}","starred_url":"https://api.github.com/users/Danielmoraisg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Danielmoraisg/subscriptions","organizations_url":"https://api.github.com/users/Danielmoraisg/orgs","repos_url":"https://api.github.com/users/Danielmoraisg/repos","events_url":"https://api.github.com/users/Danielmoraisg/events{/privacy}","received_events_url":"https://api.github.com/users/Danielmoraisg/received_events","type":"User","user_view_type":"public","site_admin":false},"body":"after https://github.com/gbrlcustodio/pipefy-mcp-server/pull/24 we added the phase information on get_card query and i forgot to change it on these tests, do you mind adding it here too? ðŸ˜… ","created_at":"2026-01-16T11:55:21Z","updated_at":"2026-01-16T11:55:21Z","html_url":"https://github.com/gbrlcustodio/pipefy-mcp-server/pull/25#discussion_r2698240896","pull_request_url":"https://api.github.com/repos/gbrlcustodio/pipefy-mcp-server/pulls/25","_links":{"self":{"href":"https://api.github.com/repos/gbrlcustodio/pipefy-mcp-server/pulls/comments/2698240896"},"html":{"href":"https://github.com/gbrlcustodio/pipefy-mcp-server/pull/25#discussion_r2698240896"},"pull_request":{"href":"https://api.github.com/repos/gbrlcustodio/pipefy-mcp-server/pulls/25"}},"reactions":{"url":"https://api.github.com/repos/gbrlcustodio/pipefy-mcp-server/pulls/comments/2698240896/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":756,"original_start_line":756,"start_side":"RIGHT","line":759,"original_line":759,"side":"RIGHT","author_association":"COLLABORATOR","original_position":10,"position":10,"subject_type":"line"}]